{
  "variables": {
    "vpc_id": "{{env `PACKER_VPC_ID`}}",
    "subnet_id": "{{env `PACKER_SUBNET_ID`}}",
    "sg_id": "{{env `PACKER_SECURITY_ID`}}"
  },

  "builders": [{
    "type": "amazon-ebs",
    "region": "us-west-2",
    "source_ami": "ami-221ea342",
    "instance_type": "t2.micro",
    "ami_name": "astuary-{{timestamp}}",
    "vpc_id": "{{user `vpc_id`}}",
    "subnet_id": "{{user `subnet_id`}}",
    "security_group_id": "{{user `sg_id`}}",
    "ssh_username": "admin",
    "ssh_port": 22,
    "tags": {
      "project": "astuary"
    }
  }],

  "provisioners": [{
    "type": "shell",
    "script": "scripts/bootstrap.sh"
  }, {
    "type": "file",
    "source": "docker/proxy.yml",
    "destination": "/reckerops/proxy/docker-compose.yml"
  },{
    "type": "file",
    "source": "docker/astuary.yml",
    "destination": "/reckerops/app/docker-compose.yml"
  },{
    "type": "file",
    "source": "secrets/astuary.env",
    "destination": "/reckerops/app/secrets.env"
  }]
}
