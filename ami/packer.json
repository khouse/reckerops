{
  "variables": {
    "token": "{{env `DIGITALOCEAN_API_TOKEN`}}",
    "name": "{{env `PACKER_NAME`}}",
    "region": "{{env `PACKER_REGION`}}",
    "size": "{{env `PACKER_SIZE`}}",
    "image": "{{env `PACKER_IMAGE`}}"
  },
  "builders": [{
    "type": "digitalocean",
    "ssh_username": "root",
    "api_token": "{{user `token`}}",
    "size": "{{user `size`}}",
    "region": "{{user `region`}}",
    "image": "{{user `image`}}",
    "droplet_name": "{{user `name`}}-{{timestamp}}",
    "snapshot_name": "{{user `name`}}"
  }],
  "provisioners": [{
    "type": "shell",
    "script": "scripts/before-salt.sh"
  },{
    "type": "salt-masterless",
    "local_state_tree": "salt",
    "local_pillar_roots": "pillar",
    "minion_config": "minion/{{user `name`}}"
  },{
    "type": "shell",
    "script": "scripts/after-salt.sh"
  },{
    "type": "file",
    "source": "../secrets/{{ user `name` }}.env",
    "destination": "/reckerops/docker/docker.env"
  }]
}
