language: ruby

addons:
  apt:
    packages:
      - pep8

before_install: scripts/travis-private-key.sh

env:
  global:
    - KITCHEN_LOCAL_YAML=".kitchen.travis.yml"
  matrix:
    - COMMAND="bundle exec rubocop"
    - COMMAND="pep8 ."
    - BUILD_IMAGE="rochester" COMMAND="bundle exec kitchen test $BUILD_IMAGE"
    - COMMAND="cd cloudformation && bundle exec stack_master validate"

script: $COMMAND

after_script: bundle exec kitchen destroy

notifications:
  email: false

branches:
  only:
    - master
